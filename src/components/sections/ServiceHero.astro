---
import { Image } from "astro:assets";
import { getImage } from "astro:assets";

interface Props {
    HeroImage: ImageMetadata;
    title: string;
    nameTransition: string;
}

const { HeroImage, title, nameTransition } = Astro.props;

const blurImage = await getImage({
    src: HeroImage,
    format: "webp",
    width: 150,
    quality: 50
});
---

<section
    class="relative h-[300px] md:h-[40vh] md:min-h-[400px] flex items-center justify-center overflow-hidden bg-neutral-900"
>
    <div class="absolute inset-0">
        {/* Low Res Placeholder */}
        <img
            src={blurImage.src}
            alt=""
            class="hero-image-anim absolute inset-0 w-full h-full object-cover brightness-[0.3] contrast-[1.1] blur-sm"
            aria-hidden="true"
        />

        {/* High Res Image */}
        <Image
            transition:name={`img-${nameTransition}`}
            src={HeroImage}
            alt="Foto tomando medidas en obra civil"
            class="hero-image-high hero-image-anim w-full h-full object-cover brightness-[0.3] contrast-[1.1] opacity-0 transition-opacity duration-1500 ease-out"
            loading="eager"
            fetchpriority="high"
            quality={80}
            widths={[640, 1024, 1536, 2048]}
            sizes="100vw"
            format="avif"
        />
    </div>

    <div
        class="relative z-10 container mx-auto px-4 sm:px-6 lg:px-8 text-start hero-content"
    >
        <div class="max-w-3xl">
            <p
                class="text-base sm:text-lg md:text-xl text-primary-500 font-semibold uppercase tracking-wider mb-3 md:mb-4"
            >
                Barreto Infraestructuras
            </p>
            <h1
                class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold mb-4 md:mb-6 text-white"
            >
                {title}
            </h1>
        </div>
    </div>
</section>

<style>
    /* Animación suave para el contenido del hero */
    .hero-content {
        animation: fadeInUp 1s ease-out 0.3s forwards;
        opacity: 0;
    }

    .hero-image-anim {
        animation: subtleScale 15s alternate infinite ease-in-out;
    }

    @keyframes subtleScale {
        0% { transform: scale(1.05); }
        100% { transform: scale(1.15); }
    }

    @keyframes fadeInUp {
        0% {
            opacity: 0;
            transform: translateY(15px);
        }
        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Mejora la transición de la imagen */
    img {
        transition: filter 0.5s ease-out;
    }

    /* Respeto por preferencias de animación reducida */
    @media (prefers-reduced-motion: reduce) {
        .hero-content {
            animation: none;
            opacity: 1;
            transform: none;
        }
    }
</style>

<script>
    function initHeroImageLoad() {
        const images = document.querySelectorAll('.hero-image-high');
        images.forEach((img) => {
            if (img instanceof HTMLImageElement) {
                if (img.complete) {
                    img.classList.remove('opacity-0');
                } else {
                    img.addEventListener('load', () => {
                        img.classList.remove('opacity-0');
                    });
                }
            }
        });
    }

    document.addEventListener('astro:page-load', initHeroImageLoad);
    initHeroImageLoad();
</script>
