---
import { Image } from "astro:assets";

import heroImage1 from "@assets/img/carousel/edificacion.webp";
import heroImage2 from "@assets/img/carousel/obra_civil.webp";
import heroImage3 from "@assets/img/carousel/rehabilitación.webp";
import heroImage4 from "@assets/img/carousel/reforma.webp";
import heroImage5 from "@assets/img/carousel/mantenimiento.webp";

const slides = [
    {
        id: 1,
        image: heroImage1,
        alt: "Edificación de gasolinera moderna",
    },
    {
        id: 2,
        image: heroImage2,
        alt: "Obra Civil aeroportuaria - asfaltado de pista de aterrizaje",
    },
    {
        id: 3,
        image: heroImage3,
        alt: "Rehabilitación de piscina natural",
    },
    {
        id: 4,
        image: heroImage4,
        alt: "Reforma de cocina moderna y elegante",
    },
    {
        id: 5,
        image: heroImage5,
        alt: "Mantenimiento y pintura deposito industrial",
    },
];
---

<section class="relative w-full h-[70dvh] overflow-hidden bg-neutral-900" role="region" aria-label="Banner principal con carrusel de proyectos">
    <div class="embla h-full">
        <div class="embla__container h-full flex">
            {
                slides.map((slide, index) => (
                    <div class="embla__slide relative min-w-0 flex-[0_0_100%] bg-black">
                        <Image
                            src={slide.image}
                            alt={slide.alt}
                            class="object-cover w-full h-full opacity-30"
                            loading={index === 0 ? "eager" : "lazy"}
                            decoding={index === 0 ? "sync" : "async"}
                            fetchpriority={index === 0 ? "high" : "auto"}
                            quality={80}
                            widths={[640, 768, 1024, 1280, 1536, 1920, 2560, 3840]}
                            sizes="100vw"
                            format="avif"
                        />
                    </div>
                ))
            }
        </div>
    </div>
    <div class="absolute inset-0 flex items-center">
        <div class="container mx-auto px-4 sm:px-8 lg:px-8">
            <div class="max-w-3xl hero-content">
                <h1
                    class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold text-neutral-50 leading-tight mb-6 sm:mb-0 tracking-tight"
                >
                    Construimos confianza.
                    <br />
                    <span class="text-primary-500">Rehabilitamos el futuro.</span
                    >
                </h1>
                <p
                    class="text-lg sm:text-xl md:text-2xl text-[hsl(var(--hero-text))]/90 mb-8 sm:mb-0 max-w-2xl"
                >
                    Expertos en construcción y mantenimiento con más de 20 años de experiencia
                </p>
            </div>
        </div>
    </div>
</section>

<style>
    /* Animación suave para el contenido del hero */
    .hero-content {
        animation: fadeInUp 1.2s ease-out 0.4s forwards;
        opacity: 0;
    }

    @keyframes fadeInUp {
        0% {
            opacity: 0;
            transform: translateY(20px);
        }
        100% {
            opacity: 1;
            transform: translateY(0);
        }
    }

    /* Transición suave para el cambio de slides */
    .embla__slide {
        transition: opacity 0.8s ease-out;
    }

    /* Mejora la transición de las imágenes */
    .embla__slide img {
        transition: filter 0.8s ease-out;
    }

    /* Respeto por preferencias de animación reducida */
    @media (prefers-reduced-motion: reduce) {
        .hero-content {
            animation: none;
            opacity: 1;
            transform: none;
        }
        
        .embla__slide,
        .embla__slide img {
            transition: none;
        }
    }
</style>

<script>
    function initCarousel() {
        const emblaNode = document.querySelector(".embla");
        if (emblaNode instanceof HTMLElement) {
            // Importación dinámica para reducir el bundle inicial
            Promise.all([
                import("embla-carousel"),
                import("embla-carousel-autoplay")
            ]).then(([EmblaCarouselModule, AutoplayModule]) => {
                const EmblaCarousel = EmblaCarouselModule.default;
                const Autoplay = AutoplayModule.default;
                
                const options = { loop: true };
                const plugins = [Autoplay({ delay: 2000 })];
                
                window.requestAnimationFrame(() => {
                    EmblaCarousel(emblaNode, options, plugins);
                });
            });
        }
    }

    // Inicializar en carga de página (compatible con view transitions)
    document.addEventListener('astro:page-load', initCarousel);
</script>
