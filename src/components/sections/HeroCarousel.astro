---
import HeroImage from "@components/ui/HeroImage.astro";

import heroImage1 from "@assets/img/carousel/edificacion.webp";
import heroImage2 from "@assets/img/carousel/obra_civil.webp";
import heroImage3 from "@assets/img/carousel/rehabilitación.webp";
import heroImage4 from "@assets/img/carousel/reforma.webp";
import heroImage5 from "@assets/img/carousel/mantenimiento.webp";

const slides = [
    {
        id: 1,
        image: heroImage1,
        alt: "Edificación de gasolinera moderna",
    },
    {
        id: 2,
        image: heroImage2,
        alt: "Obra Civil aeroportuaria - asfaltado de pista de aterrizaje",
    },
    {
        id: 3,
        image: heroImage3,
        alt: "Rehabilitación de piscina natural",
    },
    {
        id: 4,
        image: heroImage4,
        alt: "Reforma de cocina moderna y elegante",
    },
    {
        id: 5,
        image: heroImage5,
        alt: "Mantenimiento y pintura deposito industrial",
    },
];
---

<section class="relative w-full h-[70dvh] overflow-hidden bg-neutral-900" role="region" aria-label="Banner principal con carrusel de proyectos">
    <!-- Carousel Viewport -->
    <div class="carousel-viewport absolute inset-0 w-full h-full">
        {
            slides.map((slide, index) => {
                // Restamos 1.2s (4% de 30s) extra para que la primera imagen empiece ya posicionada (fase estática)
                // y no veamos la animación de entrada al cargar la página.
                const delay = (index * 6) - 30 - 1.2;
                return (
                    <div 
                        class="carousel-slide absolute inset-0 w-full h-full"
                        style={`animation-delay: ${delay}s;`}
                    >
                        <HeroImage
                            src={slide.image}
                            alt={slide.alt}
                            loading={index === 0 ? "eager" : "lazy"}
                            priority={index === 0}
                            duration="duration-1200"
                        />
                    </div>
                );
            })
        }
    </div>

    <!-- Static Content Overlay -->
    <div class="absolute inset-0 flex items-center z-20 pointer-events-none">
        <div class="container mx-auto px-4 sm:px-8 lg:px-8">
            <div class="max-w-3xl hero-content pointer-events-auto animate-fade-in-up opacity-0">
                <h1
                    class="text-4xl sm:text-5xl md:text-6xl lg:text-7xl font-bold text-neutral-50 leading-tight mb-6 sm:mb-0 tracking-tight"
                >
                    Construimos confianza.
                    <br />
                    <span class="text-primary-500">Rehabilitamos el futuro.</span
                    >
                </h1>
                <p
                    class="text-lg sm:text-xl md:text-2xl text-[hsl(var(--hero-text))]/90 mb-8 sm:mb-0 max-w-2xl"
                >
                    Expertos en construcción y mantenimiento con más de 20 años de experiencia
                </p>
            </div>
        </div>
    </div>
</section>

<style>
    :root {
        --total-time: 30s;
    }

    .carousel-viewport {
        contain: paint layout;
    }

    .carousel-slide {
        will-change: transform;
        transform: translate3d(100%, 0, 0);
        animation: carouselCycle var(--total-time) linear infinite;
        backface-visibility: hidden;
        z-index: 1;
    }

    @keyframes carouselCycle {
        /* FASE 1: ENTRADA (Slide In) */
        0% {
            transform: translate3d(100%, 0, 0);
            z-index: 10;
        }
        4% {
            transform: translate3d(0, 0, 0);
            z-index: 10;
        }
        
        /* FASE 2: LECTURA (Static) */
        20% {
            transform: translate3d(0, 0, 0);
            z-index: 10;
        }

        /* FASE 3: SALIDA (Slide Out) */
        24% {
            transform: translate3d(-100%, 0, 0);
            z-index: 10;
        }

        /* FASE 4: RESET */
        24.01% {
            transform: translate3d(100%, 0, 0);
            z-index: -1;
        }
        100% {
            transform: translate3d(100%, 0, 0);
            z-index: -1;
        }
    }

    @media (prefers-reduced-motion: reduce) {
        .hero-content {
            animation: none;
            opacity: 1;
            transform: none;
        }
        
        .carousel-slide {
            animation: none;
            transform: none;
        }
        
        .carousel-slide {
            position: absolute;
            inset: 0;
            opacity: 0;
        }
        
        .carousel-slide:first-child {
            opacity: 1;
        }
    }
</style>
