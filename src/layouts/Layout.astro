---
import Footer from "@components/sections/Footer.astro";
import Header from "@components/sections/Header.astro";
import LocalBusinessSchema from "@components/common/LocalBusinessSchema.astro";
import CookieConsent from "@components/common/CookieConsent.astro";
import GoogleAds from "@components/common/GoogleAds.astro";
import { ClientRouter } from 'astro:transitions';

// Fuentes para el logo
import "@fontsource/source-sans-3/600.css";
import "@fontsource/source-sans-3/500.css";
import "@fontsource-variable/roboto";

// reCAPTCHA Site Key (pública, segura para exponer)
const RECAPTCHA_SITE_KEY = import.meta.env.PUBLIC_RECAPTCHA_SITE_KEY;

interface Props {
    title?: string;
    description?: string;
    keywords?: string;
    ogImage?: string;
    ogType?: string;
    canonical?: string;
}

const {
    title = "Barreto Construcciones - Empresa de Construcción en Madrid y Toledo",
    description = "Empresa líder en construcción, edificación, obra civil, reformas y rehabilitación en Madrid y Toledo. +20 años de experiencia. Proyectos corporativos, industriales y residenciales con garantía de calidad.",
    keywords = "construcción Madrid, construcción Toledo, obra civil, edificación, reformas, rehabilitación, mantenimiento industrial, empresa construcción, construcción industrial, reformas empresas, proyectos construcción",
    ogImage = "/logo.webp",
    ogType = "website",
    canonical = Astro.url.pathname
} = Astro.props;

const siteUrl = Astro.site ? Astro.site.toString() : "https://barretoconstrucciones.es";
const canonicalURL = new URL(canonical, siteUrl).href;
const fullOgImage = new URL(ogImage, siteUrl).href;

const isProduction = Astro.url.host === 'barretoconstrucciones.es';
const robotsContent = isProduction 
    ? "index, follow, max-image-preview:large" 
    : "noindex, nofollow";
---

<!doctype html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        
        <!-- Primary Meta Tags -->
        <title>{title}</title>
        <meta name="title" content={title} />
        <meta name="description" content={description} />
        <meta name="keywords" content={keywords} />
        <meta name="author" content="Barreto Construcciones" />
        <meta name="robots" content={robotsContent} />
        <link rel="canonical" href={canonicalURL} />
        
        <!-- Favicon -->
        <link rel="icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="apple-touch-icon" sizes="180x180" href="/logo.webp" />
        
        <!-- Open Graph / Facebook -->
        <meta property="og:type" content={ogType} />
        <meta property="og:url" content={canonicalURL} />
        <meta property="og:title" content={title} />
        <meta property="og:description" content={description} />
        <meta property="og:image" content={fullOgImage} />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <meta property="og:locale" content="es_ES" />
        <meta property="og:site_name" content="Barreto Construcciones" />
        
        <!-- Twitter -->
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:url" content={canonicalURL} />
        <meta name="twitter:title" content={title} />
        <meta name="twitter:description" content={description} />
        <meta name="twitter:image" content={fullOgImage} />
        
        <!-- Additional SEO -->
        <meta name="geo.region" content="ES-M" />
        <meta name="geo.placename" content="Madrid, Toledo" />
        <meta name="geo.position" content="40.416775;-3.703790" />
        <meta name="ICBM" content="40.416775, -3.703790" />
        
        <!-- Google Ads -->
        <GoogleAds />
        
        <!-- Schema.org JSON-LD -->
        <script type="application/ld+json" set:html={JSON.stringify({
            "@context": "https://schema.org",
            "@type": "GeneralContractor",
            "name": "Barreto Construcciones",
            "alternateName": "Barreto Infraestructuras",
            "description": "Empresa de construcción especializada en edificación, obra civil, reformas y rehabilitación en Madrid y Toledo",
            "url": siteUrl,
            "logo": fullOgImage,
            "image": fullOgImage,
            "telephone": ["+34925090798", "+34911460524"],
            "email": "info@barretoconstrucciones.es",
            "address": [
                {
                    "@type": "PostalAddress",
                    "addressLocality": "Yuncos",
                    "addressRegion": "Toledo",
                    "postalCode": "45210",
                    "addressCountry": "ES",
                    "geo": {
                        "@type": "GeoCoordinates",
                        "latitude": "40.087",
                        "longitude": "-3.873"
                    }
                },
                {
                    "@type": "PostalAddress",
                    "streetAddress": "Calle Gutenberg 2 - 1º Planta",
                    "addressLocality": "Getafe",
                    "addressRegion": "Madrid",
                    "postalCode": "28906",
                    "addressCountry": "ES",
                    "geo": {
                        "@type": "GeoCoordinates",
                        "latitude": "40.305",
                        "longitude": "-3.725"
                    }
                }
            ],
            "areaServed": [
                {
                    "@type": "City",
                    "name": "Madrid"
                },
                {
                    "@type": "City",
                    "name": "Toledo"
                },
                {
                    "@type": "City",
                    "name": "Getafe"
                },
                {
                    "@type": "City",
                    "name": "Yuncos"
                }
            ],
            "priceRange": "€€€",
            "foundingDate": "2000",
            "numberOfEmployees": {
                "@type": "QuantitativeValue",
                "value": "20"
            },
            "slogan": "Construimos confianza. Rehabilitamos el futuro.",
            "knowsAbout": ["Construcción", "Edificación", "Obra Civil", "Rehabilitación", "Reformas", "Mantenimiento Industrial"],
            "hasOfferCatalog": {
                "@type": "OfferCatalog",
                "name": "Servicios de Construcción",
                "itemListElement": [
                    {
                        "@type": "Offer",
                        "itemOffered": {
                            "@type": "Service",
                            "name": "Construcción Industrial",
                            "description": "Construcción de viviendas, naves y proyectos industriales en Madrid y Toledo"
                        }
                    },
                    {
                        "@type": "Offer",
                        "itemOffered": {
                            "@type": "Service",
                            "name": "Rehabilitación",
                            "description": "Rehabilitación técnica y estructural de edificios"
                        }
                    },
                    {
                        "@type": "Offer",
                        "itemOffered": {
                            "@type": "Service",
                            "name": "Obra Civil",
                            "description": "Servicios de urbanización, pavimentación, asfaltado y cimentaciones"
                        }
                    },
                    {
                        "@type": "Offer",
                        "itemOffered": {
                            "@type": "Service",
                            "name": "Mantenimiento Industrial",
                            "description": "Servicios integrales de mantenimiento de infraestructuras"
                        }
                    }
                ]
            },
            "sameAs": [
                "https://www.instagram.com/barretoconstrucciones/",
                "https://www.linkedin.com/company/barreto-construcciones/"
            ]
        })} />
        
        <!-- Schema.org WebSite para búsqueda -->
        <script type="application/ld+json" set:html={JSON.stringify({
            "@context": "https://schema.org",
            "@type": "WebSite",
            "name": "Barreto Construcciones",
            "alternateName": "Barreto Infraestructuras",
            "url": siteUrl,
            "potentialAction": {
                "@type": "SearchAction",
                "target": {
                    "@type": "EntryPoint",
                    "urlTemplate": `${siteUrl}/proyectos?q={search_term_string}`
                },
                "query-input": "required name=search_term_string"
            },
            "inLanguage": "es-ES",
            "publisher": {
                "@type": "Organization",
                "name": "Barreto Construcciones",
                "logo": {
                    "@type": "ImageObject",
                    "url": fullOgImage
                }
            }
        })} />
        
        <ClientRouter />
        
        <!-- reCAPTCHA v3 -->

    </head>
    <body>
        <LocalBusinessSchema />
        <a href="#main-content" class="skip-link">Saltar al contenido principal</a>
        <Header />
        <main id="main-content" class="pt-20" role="main">
            <slot />
        </main>
        <Footer />
        <CookieConsent />
    </body>
</html>

<style is:global>
    @import "../styles/global.css";
    @plugin "@midudev/tailwind-animations";
</style>

