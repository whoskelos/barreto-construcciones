---
import Image from "astro/components/Image.astro";
import { getImage } from "astro:assets";
import Layout from "../../layouts/Layout.astro";
import HeroImage from "@assets/img/featured/edificacion/3.webp";
import ServiceCard from "@components/ui/ServiceImageCard.astro";
import { getCollection } from "astro:content";

const services = await getCollection("services");

const blurImage = await getImage({
    src: HeroImage,
    format: "webp",
    width: 150,
    quality: 50
});
---

<Layout 
    title="Nuestras áreas de negocio Industrial - Rehabilitación, Residencial, Obra Civil, Mantenimiento | Madrid - Toledo"
    description="Desarrollamos proyectos de construcción en Madrid y Toledo. Conozca nuestras principales áreas de negocio: Industrial, Rehabilitación, Residencial, Obra Civil y Mantenimiento."
    keywords="empresa constructora Madrid, servicios de construcción Madrid y Toledo, construcción integral, construcción industrial Madrid, rehabilitación de edificios, construcción residencial, servicios obra civil Madrid, mantenimiento industrial"
    canonical="/areas-de-negocio"
>
    <section
        class="relative h-[30vh] min-h-[200px] md:h-[40vh] md:min-h-[400px] flex items-center justify-center overflow-hidden bg-neutral-900"
        aria-labelledby="areas-title"
    >
        <div class="absolute inset-0">
            {/* Low Res Placeholder */}
            <img
                src={blurImage.src}
                alt=""
                class="hero-image-anim absolute inset-0 w-full h-full object-cover brightness-[0.3] contrast-[1.1] blur-sm"
                aria-hidden="true"
            />

            {/* High Res Image */}
            <Image
                src={HeroImage}
                alt="Equipo de Barreto Construcciones tomando medidas en una obra civil activa"
                class="hero-image-high hero-image-anim w-full h-full object-cover brightness-[0.3] contrast-[1.1] opacity-0 transition-opacity duration-1500 ease-out"
                loading="eager"
                fetchpriority="high"
                quality={80}
                widths={[640, 1024, 1536, 2048]}
                sizes="100vw"
                format="avif"
            />
        </div>

        <div
            class="relative z-10 container mx-auto px-4 sm:px-6 lg:px-8 text-start animate-fade-in-up"
        >
            <div class="max-w-3xl">
                <p
                    class="text-accent text-sm sm:text-md md:text-lg text-primary-500 font-semibold uppercase tracking-wider mb-3 md:mb-4"
                >
                    Barreto Infraestructuras
                </p>
                <h1
                    id="areas-title"
                    class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold mb-4 md:mb-6 text-white"
                >
                    Áreas de negocio
                </h1>
            </div>
        </div>
    </section>

    <section class="container mx-auto px-4 sm:px-6 lg:px-8 py-16 md:py-24" aria-labelledby="services-heading">
        <h2
            id="services-heading"
            class="text-3xl sm:text-4xl md:text-5xl max-w-4xl mx-auto text-neutral-900 text-center font-bold mb-8"
        >
            Servicios integrales de construcción para empresas e instituciones
        </h2>
        <p class="text-md text-neutral-800 text-center pb-12 max-w-3xl mx-auto">
            Barreto Infraestructuras cuenta con un equipo multidisciplinar
            altamente cualificado.
        </p>

        <div
            class="w-full grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"
        >
            {
                services.map((service) => (
                    <ServiceCard
                        name={service.data.title}
                        description={service.data.introDescription}
                        image={service.data.heroImage}
                        url={`/areas-de-negocio/${service.id}`}
                        transitionName={`img-${service.data.nameTransition}`}
                    />
                ))
            }
        </div>
    </section>
</Layout>

<style>
    .hero-image-anim {
        animation: subtleScale 15s alternate infinite ease-in-out;
    }

    @keyframes subtleScale {
        0% { transform: scale(1.05); }
        100% { transform: scale(1.15); }
    }

    @media (prefers-reduced-motion: reduce) {
        .hero-image-anim {
            animation: none;
            transform: none;
        }
    }
</style>

<script>
    function initHeroImageLoad() {
        const images = document.querySelectorAll('.hero-image-high');
        images.forEach((img) => {
            if (img instanceof HTMLImageElement) {
                if (img.complete) {
                    img.classList.remove('opacity-0');
                } else {
                    img.addEventListener('load', () => {
                        img.classList.remove('opacity-0');
                    });
                }
            }
        });
    }

    document.addEventListener('astro:page-load', initHeroImageLoad);
    initHeroImageLoad();
</script>

